(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-798bc394"],{"0199":function(t,a,e){},"1af6":function(t,a,e){var i=e("63b6");i(i.S,"Array",{isArray:e("9003")})},"774e":function(t,a,e){t.exports=e("d2d5")},a3d3:function(t,a,e){"use strict";var i=e("0199"),r=e.n(i);r.a},a745:function(t,a,e){t.exports=e("f410")},c8bb:function(t,a,e){t.exports=e("54a1")},f410:function(t,a,e){e("1af6"),t.exports=e("584a").Array.isArray},ff66:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[[e("div",{staticClass:"top"},[e("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"输入关键词搜索……"},on:{search:t.onSearch}}),e("a-button",{attrs:{type:"primary",shape:"circle",icon:"plus"},on:{click:function(a){t.drawerShow=!0}}},[t._v("添加")])],1),e("a-table",{attrs:{columns:t.columns,rowKey:function(t){return t.id},dataSource:t.tableData,pagination:t.pagination,loading:t.loading,bordered:""},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"operation",fn:function(a,i){return[e("a-switch",{attrs:{checked:1===i.state,checkedChildren:"上架",unCheckedChildren:"下架"},on:{change:function(a){return t.stateUpdate(i,a)}}}),e("a-button",{staticStyle:{margin:"0 6px"},attrs:{type:"primary",size:"small"},on:{click:function(a){return t.showDrawer(i)}}},[t._v("查看")]),e("a-button",{attrs:{size:"small"},on:{click:function(a){return t.showSpecs(i)}}},[t._v("规格")])]}}])}),e("a-drawer",{attrs:{title:"商品详情",width:720,visible:t.drawerShow,wrapClassName:"drawer-cont",destroyOnClose:""},on:{close:function(){return t.drawerShow=!1}}},[e("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[e("a-row",{attrs:{gutter:16}},[e("a-form-item",[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["productId"],expression:"['productId']"}],attrs:{type:"hidden"}}),e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["state"],expression:"['state']"}],attrs:{type:"hidden"}})],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"商品名称"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["productName"],expression:"['productName']"}]})],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"商品专区"}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["zoneid"],expression:"['zoneid']"}],staticStyle:{width:"100%"},attrs:{allowClear:""}},t._l(t.zoneList,function(a,i){return e("a-select-option",{attrs:{value:a.id}},[t._v(t._s(a.name))])}),1)],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"商品二级分类"}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["producttypeid"],expression:"['producttypeid']"}],staticStyle:{width:"100%"}},t._l(t.sortList,function(a,i){return e("a-select-option",{attrs:{value:a.id}},[t._v(t._s(a.name))])}),1)],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"满减优惠"}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["discount_id"],expression:"['discount_id']"}],staticStyle:{width:"100%"},attrs:{allowClear:""}},t._l(t.discountList,function(a,i){return e("a-select-option",{attrs:{value:a.id}},[t._v("满"+t._s(a.price)+"减"+t._s(a.money)+"\n                ")])}),1)],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"品牌"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["brand"],expression:"['brand']"}]})],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"商品描述"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["describion"],expression:"['describion']"}],attrs:{type:"textarea"}})],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"售后信息"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["after_information"],expression:"['after_information']"}],attrs:{type:"textarea"}})],1)],1)],1),e("a-upload",{attrs:{action:"/upload",showUploadList:!1},on:{change:t.handleChange}},[e("a-button",{attrs:{type:"primary",shape:"circle",icon:"upload"}},[t._v("上传商品小图")])],1),e("div",{staticClass:"img-cont"},[e("div",{staticClass:"img-box"},[e("img",{attrs:{src:t.image,alt:""}})])]),e("a-upload",{attrs:{action:"/addImg",showUploadList:!1},on:{change:t.handleChangeInfo}},[e("a-button",{attrs:{type:"primary",shape:"circle",icon:"upload"}},[t._v("上传商品详情图")])],1),e("div",{staticClass:"img-cont"},t._l(t.imageList,function(a,i){return e("div",{key:i,staticClass:"img-box",on:{click:function(a){return t.deleteImage(i)}}},[e("div",{staticClass:"ico"},[e("a-icon",{attrs:{type:"delete",theme:"filled"}})],1),e("img",{attrs:{src:a.img,alt:a.product_id}})])}),0),e("div",{staticClass:"drawer-footer"},[e("a-button",{style:{marginRight:"8px"},on:{click:function(){return t.drawerShow=!1}}},[t._v("取消")]),e("a-button",{attrs:{type:"primary","html-type":"submit"}},[t._v("保存")])],1)],1)],1),e("a-drawer",{attrs:{title:"规格设置",width:720,visible:t.drawerShowSpecs,wrapClassName:"drawer-cont",destroyOnClose:""},on:{close:function(){return t.drawerShowSpecs=!1}}},[e("a-button",{staticClass:"editable-add-btn",staticStyle:{"margin-bottom":"6px"},on:{click:function(){return t.formSpecsShow=!t.formSpecsShow}}},[t._v("添加\n      ")]),e("a-table",{attrs:{columns:t.specsList.concat(t.columnsSpecs),dataSource:t.tableDataSpecs,size:"small",pagination:!1,bordered:""},scopedSlots:t._u([t._l(t.newColumns,function(a){return{key:a,fn:function(i,r,n){return[e("div",{key:a},[r.editable?e("a-input",{staticStyle:{margin:"-5px 0"},attrs:{value:i},on:{change:function(e){return t.handleEdit(e.target.value,r.id,a)}}}):[t._v(t._s(i))]],2)]}}}),{key:"operation",fn:function(a,i,r){return[e("div",{staticClass:"editable-row-operations"},[i.editable?e("span",[e("a",{staticStyle:{"margin-right":"10px"},on:{click:function(){return t.save(i.id)}}},[t._v("保存")]),e("a-popconfirm",{attrs:{title:"确定取消?"},on:{confirm:function(){return t.cancel(i.id)}}},[e("a",[t._v("取消")])])],1):e("span",[e("a",{staticStyle:{"margin-right":"10px"},on:{click:function(){return t.edit(i.id)}}},[t._v("编辑")]),e("a-popconfirm",{attrs:{title:"确定删除?"},on:{confirm:function(){return t.removeSpecs(i)}}},[e("a",[t._v("删除")])])],1)])]}}],null,!0)}),t.formSpecsShow?e("a-form",{attrs:{form:t.formSpecs},on:{submit:t.handleSubmitSpecs}},[e("a-row",{attrs:{gutter:16}},[t._l(t.specsList,function(t){return e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:t.title}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:[t.title],expression:"[item.title]"}]})],1)],1)}),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"库存"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["number"],expression:"['number']"}]})],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"销售价格"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["price"],expression:"['price']"}]})],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"折扣价格"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["discount_price"],expression:"['discount_price']"}]})],1)],1),e("a-col",{attrs:{span:12}},[e("a-form-item",{attrs:{label:"成本价格"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["cost_price"],expression:"['cost_price']"}]})],1)],1)],2),e("a-button",{attrs:{type:"primary","html-type":"submit"}},[t._v("保存")])],1):t._e()],1)]],2)},r=[],n=e("cebc"),s=e("a745"),o=e.n(s);function c(t){if(o()(t)){for(var a=0,e=new Array(t.length);a<t.length;a++)e[a]=t[a];return e}}var d=e("774e"),l=e.n(d),u=e("c8bb"),p=e.n(u);function m(t){if(p()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return l()(t)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(t){return c(t)||m(t)||f()}var v={name:"Ware",data:function(){return{columns:[{title:"编号",dataIndex:"id"},{title:"商品名称",dataIndex:"productName"},{title:"品牌",dataIndex:"brand"},{title:"商品分类",dataIndex:"producttypename"},{title:"操作",dataIndex:"operation",width:"200px",scopedSlots:{customRender:"operation"}}],tableData:[],pagination:{},loading:!1,searchKey:"",drawerShowSpecs:!1,tableDataSpecs:[],columnsSpecs:[{title:"折扣价",dataIndex:"discount_price",scopedSlots:{customRender:"discount_price"}},{title:"成本价",dataIndex:"cost_price",scopedSlots:{customRender:"cost_price"}},{title:"价格(元)",dataIndex:"price",scopedSlots:{customRender:"price"}},{title:"库存",dataIndex:"number",scopedSlots:{customRender:"number"}},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"}}],specsList:[],drawerShow:!1,form:this.$form.createForm(this),zoneList:[],discountList:[],sortList:[],image:"",imageList:[],formSpecsShow:!1,formSpecs:this.$form.createForm(this),cacheId:null}},methods:{handleSubmitSpecs:function(t){var a=this;t.preventDefault(),this.formSpecs.validateFields(function(t,e){if(!t){var i={};for(var r in e)/^[a-zA-Z_]*$/.test(r)||(i[r]=e[r]);e.specificationName=JSON.stringify(i),e["product_id"]=a.cacheId,a.$ajax({url:"addSpecificationService",data:e}).then(function(t){1===t.data.code&&(a.$message.success(t.data.msg),a.showSpecs({id:a.cacheId}),a.formSpecs.resetFields(),a.formSpecsShow=!1)})}})},removeSpecs:function(t){var a=this;this.$ajax({url:"deleteProductSpecificationById",data:{id:t.id}}).then(function(t){1===t.data.code&&(a.showSpecs({id:a.cacheId}),a.$message.success(t.data.msg))})},handleEdit:function(t,a,e){var i=h(this.tableDataSpecs),r=i.filter(function(t){return a===t.id})[0];r&&(r[e]=t,this.tableDataSpecs=i)},edit:function(t){var a=h(this.tableDataSpecs),e=a.filter(function(a){return t===a.id})[0];e&&(e.editable=!0,this.tableDataSpecs=a)},save:function(t){var a=this,e=h(this.tableDataSpecs),i=e.filter(function(a){return t===a.id})[0];if(i){var r={};for(var s in i)/^[a-zA-Z_]*$/.test(s)||(r[s]=i[s]);i.specificationName=JSON.stringify(r),i.id&&(i["attribute"]=i.id),this.$ajax({url:i.id?"updateProductSpecification":"addSpecificationService",data:i}).then(function(t){1===t.data.code&&(delete i.editable,a.tableDataSpecs=e,a.cacheData=e.map(function(t){return Object(n["a"])({},t)}))})}},cancel:function(t){var a=h(this.tableDataSpecs),e=a.filter(function(a){return t===a.id})[0];e&&(Object.assign(e,this.cacheData.filter(function(a){return t===a.id})[0]),delete e.editable,this.tableDataSpecs=a)},onSearch:function(t){this.searchKey=t,this.handleTableChange({current:1})},handleSubmit:function(t){var a=this;t.preventDefault(),this.form.validateFields(function(t,e){if(!t){for(var i in e)e[i]||delete e[i];e.image=a.image;for(var r=[],n=0;n<a.imageList.length;n++)r.push(a.imageList[n].img);e.file=r,a.$ajax({url:e.productId?"updateProduct":"saveProduct",data:e}).then(function(t){1===t.data.code&&(a.$message.success(t.data.msg),a.fetch(a.pagination),a.drawerShow=!1)})}})},showDrawer:function(t){var a=this;this.drawerShow=!0,this.$ajax({url:"listProductByProductIds",data:{productId:t.id}}).then(function(t){if(1===t.data.code){var e=t.data.data.result;e.discount_id=t.data.data.s1?t.data.data.s1.discountid:"",a.image=t.data.data.result.image,a.$nextTick(function(){a.form.setFieldsValue(e)})}}),this.$ajax({url:"selectProductImageByProductId",data:{productId:t.id}}).then(function(t){1===t.data.code&&(a.imageList=t.data.data)})},handleTableChange:function(t,a,e){var i=Object(n["a"])({},this.pagination);i.current=t.current,this.pagination=i,this.fetch(Object(n["a"])({limit:t.pageSize,page:t.current},a))},fetch:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.page=a.page||a.current||1,a.limit=a.limit||10,this.loading=!0,this.$ajax({url:""===this.searchKey?"listAllProductById":"listProductByProductTypeIds",data:Object(n["a"])({productName:this.searchKey},a)}).then(function(a){var e=Object(n["a"])({},t.pagination);e.total=a.data.count,t.loading=!1,t.tableData=a.data.data,t.pagination=e})},stateUpdate:function(t,a){var e=this;this.$ajax({url:"updateProductState",data:{id:t.id,state:a?1:2}}).then(function(i){1===i.data.code&&(t.state=a?1:2,e.$message.success(i.data.msg))})},showSpecs:function(t){var a=this;this.drawerShowSpecs=!0,this.cacheId=t.id,this.$ajax({method:"post",url:"selectAllspecifi",data:{product_id:t.id}}).then(function(t){if(1===t.data.code){for(var e=t.data.data,i=0;i<t.data.data.length;i++)e[i]=Object(n["a"])({},e[i],JSON.parse(t.data.data[i].specificationName));a.tableDataSpecs=e}}),this.$ajax({method:"post",url:"listSpecificationsByproducttypeid",data:{producttypeid:t.producttypeid||this.cacheId,page:1,limit:100}}).then(function(t){if(1===t.data.code){var e=[];if(0!=t.data.data.length)for(var i=0;i<t.data.data[0].specificationOptionsListss.length;i++)e.push({title:t.data.data[0].specificationOptionsListss[i].specificationsName,dataIndex:t.data.data[0].specificationOptionsListss[i].specificationsName,scopedSlots:{customRender:t.data.data[0].specificationOptionsListss[i].specificationsName}});a.specsList=e}})},getZone:function(){var t=this;this.$ajax({method:"post",url:"selectZoneList",data:{page:1,limit:100}}).then(function(a){1===a.data.code&&(t.zoneList=a.data.data)})},getDiscount:function(){var t=this;this.$ajax({method:"post",url:"pageOfDiscount",data:{page:1,limit:100}}).then(function(a){1===a.data.code&&(t.discountList=a.data.data)})},getSort:function(){var t=this;this.$ajax({method:"post",url:"selectAllProductTypeList",data:{page:1,limit:100}}).then(function(a){1===a.data.code&&(t.sortList=a.data.data)})},handleChangeInfo:function(t){1===t.file.response.code&&(this.imageList=[].concat(h(this.imageList),[{id:null,img:t.file.response.data[0]}]))},handleChange:function(t){1===t.file.response.code&&(this.image=t.file.response.data)},deleteImage:function(t){var a=this;this.$confirm({title:"提示",content:"是否删除 ?",okText:"确认",cancelText:"取消",onOk:function(){null!==a.imageList[t].id?a.$ajax({url:"deleteImg",data:{id:a.imageList[t].id}}).then(function(e){1===e.data.code&&a.imageList.splice(t,1)}):a.imageList.splice(t,1)}})}},computed:{newColumns:function(){for(var t=[],a=0;a<this.specsList.length;a++)t.push(this.specsList[a].dataIndex);for(var e=0;e<this.columnsSpecs.length;e++)t.push(this.columnsSpecs[e].dataIndex);return t}},mounted:function(){this.fetch(),this.getZone(),this.getDiscount(),this.getSort()}},g=v,b=(e("a3d3"),e("2877")),S=Object(b["a"])(g,i,r,!1,null,"2f2552d8",null);a["default"]=S.exports}}]);